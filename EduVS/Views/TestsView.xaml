<UserControl x:Class="EduVS.Views.TestsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:models="clr-namespace:EduVS.Models">
    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="5"/>
            <ColumnDefinition Width="1.5*"/>
        </Grid.ColumnDefinitions>

        <!-- left side: list + actions -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <Button Content="Refresh" Command="{Binding LoadTestsCommand}" Width="100"/>
            </StackPanel>

            <DataGrid Grid.Row="1"
                ItemsSource="{Binding Tests}"
                AutoGenerateColumns="False"
                IsReadOnly="True"
                SelectionMode="Single"
                SelectedItem="{Binding SelectedTest, Mode=TwoWay}"
                CanUserAddRows="False">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Timestamp" Binding="{Binding TimeStamp, StringFormat=G}" Width="160"/>
                    <DataGridTextColumn Header="Subject" Binding="{Binding SubjectDisplay}" Width="120"/>
                    <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="200"/>
                    <DataGridTextColumn Header="Template A Path" Binding="{Binding TemplatePathA}" Width="180"/>
                    <DataGridTextColumn Header="Template B Path" Binding="{Binding TemplatePathB}" Width="180"/>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>

        <!-- splitter -->
        <GridSplitter Grid.Column="1"
                  Width="5"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch"
                  ResizeDirection="Columns"
                  ResizeBehavior="PreviousAndNext"
                  ShowsPreview="True"
                  Background="LightGray"/>

        <!-- right side: detail / edit -->
        <Border Grid.Column="2" Padding="10" BorderBrush="LightGray" BorderThickness="1" CornerRadius="4">
            <StackPanel>
                <TextBlock FontSize="16" FontWeight="Bold" Margin="0,0,0,8"/>

                <StackPanel Orientation="Horizontal" Margin="0,4">
                    <TextBlock Text="Subject:" Width="100"/>
                    <ComboBox Width="250"
                        ItemsSource="{Binding Subjects}"
                        SelectedValuePath="Code"
                        SelectedValue="{Binding SelectedTest.SubjectCode, Mode=TwoWay}" />
                    <Button 
                        Content="Add Subject"
                        Command="{Binding AddSubjectCommand}"
                        Margin="5,0,0,0"
                        Width="100"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,4">
                    <TextBlock Text="Test name:" Width="100"/>
                    <TextBox Text="{Binding SelectedTest.Name, UpdateSourceTrigger=PropertyChanged}" Width="250"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,4">
                    <TextBlock Text="Template A Path:" Width="100"/>
                    <TextBox Text="{Binding SelectedTest.TemplatePathA, UpdateSourceTrigger=PropertyChanged}" Width="250" IsReadOnly="True"/>
                    <Button Content="Browse..." Command="{Binding BrowseTemplateACommand}" Margin="4,0,0,0" ToolTip="Select PDF" Width="100"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,4">
                    <TextBlock Text="Template B Path:" Width="100"/>
                    <TextBox Text="{Binding SelectedTest.TemplatePathB, UpdateSourceTrigger=PropertyChanged}" Width="250" IsReadOnly="True"/>
                    <Button Content="Browse..." Command="{Binding BrowseTemplateBCommand}" Margin="4,0,0,0" ToolTip="Select PDF" Width="100"/>
                </StackPanel>


                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                    <Button Content="Save" Command="{Binding SaveTestCommand}" Width="100" Margin="0,0,10,0"/>
                    <Button Content="Delete" Command="{Binding DeleteTestCommand}" Width="100" Margin="0,0,10,0"/>
                    <Button Content="Cancel" Command="{Binding CancelNewCommand}" Width="100"/>
                </StackPanel>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
